"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1215],{11215:function(e,s,n){var t=n(47568),i=n(26042),r=n(69396),u=n(10253),a=n(97582),o=n(33299),l=n(67294),c=n(11163),d=n(61437),v=n(15564),g=n(3732),f=n(19645),b=n(16682);s.Z=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).query,s=function(e){var s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var n,t;if(sessionStorage.setItem("idBusiness",e._id),sessionStorage.setItem("businessName",e.name),O(e),!s&&(null===e||void 0===e?void 0:e._id)&&(null===K||void 0===K||null===(n=K.business)||void 0===n?void 0:n._id)!==e._id&&(null===K||void 0===K||null===(t=K.business)||void 0===t?void 0:t.name)!==e.name)return H((0,r.Z)((0,i.Z)({},K),{business:(0,r.Z)((0,i.Z)({},K.business),{_id:e._id,name:e.name})}))}catch(u){console.error("Error saving business to session:",u)}},n=function(){return window.globalState["businesses.isLoadingList"]},h=(0,l.useState)([]),m=h[0],p=h[1],_=(0,l.useState)([]),y=_[0],Z=_[1],S=(0,u.Z)((0,d.Z)("businesses.list",null),2),B=S[0],w=S[1],I=(0,u.Z)((0,d.Z)("businesses.isChangingBusiness",!1),2),k=I[0],N=I[1],L=(0,u.Z)((0,d.Z)("businesses.isProcessingInvitation",!1),2),T=L[0],C=L[1],E=(0,u.Z)((0,d.Z)("businesses.isCreatingBusiness",!1),2),j=E[0],q=E[1],A=(0,u.Z)((0,d.Z)("businesses.selected",null),2),J=A[0],O=A[1],P=(0,u.Z)((0,d.Z)("user.account.email",null),3),R=P[1],W=P[2],X=(0,l.useRef)(null),F=(0,b.Z)(),U=F.get,x=F.post,z=F.remove,D=(0,c.useRouter)(),G=(0,o.useSession)(),H=G.update,K=G.data,M=D.query.redirect;(0,f.Z)().track,(0,l.useEffect)((function(){var e=sessionStorage.getItem("idBusiness"),s=sessionStorage.getItem("businessName");e&&s&&!J&&O({_id:e,name:s})}),[]),(0,l.useEffect)((function(){var e,s=(0,g.Jj)();s.globalState["businesses.list"]||s.globalState["businesses.isLoadingList"]?w(s.globalState["businesses.list"]):Q(),W.current!==(null===K||void 0===K||null===(e=K.user)||void 0===e?void 0:e.email)&&Q()}),[]),(0,l.useEffect)((function(){return(null===B||void 0===B?void 0:B.length)&&(clearTimeout(X.current),X.current=setTimeout((function(e){p(e?B.filter((function(s){return s.name.toLowerCase().includes(e.toLowerCase())})):B)}),500,e)),function(){clearTimeout(X.current)}}),[B,e]);var Q=function(){var e=(0,t.Z)((function(e){var n,t,i,r,u,o,l,c;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return n=null,"undefined"===typeof(t=(0,g.Jj)())?[2]:(null===K||void 0===K?void 0:K.user)?(t.globalState["businesses.isLoadingList"]=!0,R(K.user.email),[4,U("/business/get-by-user",{query:e}).catch(console.log)]):[2];case 1:return(i=a.sent())&&!0===i.status&&i.content?(r=i.content.businesses,u=sessionStorage.getItem("idBusiness"),o=null,u&&(o=r.find((function(e){return e._id===u}))),(l=o)?[4,$(o)]:[3,3]):[3,4];case 2:l=a.sent(),a.label=3;case 3:l?(o?s(o,!0):O(null),"true"===sessionStorage.getItem("generateWebsite")&&(n="/website/builder",sessionStorage.removeItem("generateWebsite"))):te(),w(r),p(r),t.globalState["businesses.list"]=r,(c=i.content.invitations)&&c.length?Z(c):Z([]),a.label=4;case 4:return t.globalState["businesses.isLoadingList"]=!1,n?[4,D.push((0,g.fX)(n))]:[3,6];case 5:a.sent(),a.label=6;case 6:return[2]}}))}));return function(s){return e.apply(this,arguments)}}();function V(){return Y.apply(this,arguments)}function Y(){return(Y=(0,t.Z)((function(){return(0,a.__generator)(this,(function(e){switch(e.label){case 0:return[4,Q()];case 1:return e.sent(),[2]}}))}))).apply(this,arguments)}function $(e){return ee.apply(this,arguments)}function ee(){return(ee=(0,t.Z)((function(e){var n;return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return[4,(0,v.k)(K,{idBusiness:e._id,businessName:e.name},!1)];case 1:return(n=t.sent()).ok&&200===n.status?[4,s(e,!0)]:[3,3];case 2:return t.sent(),[2,!0];case 3:return g.Z9.error("Error while setting the business, please try again. Are you sure this is one of your businesses?"),[2,!1]}}))}))).apply(this,arguments)}var se=function(){var e=(0,t.Z)((function(e,s){var n;return(0,a.__generator)(this,(function(t){switch(t.label){case 0:return[4,x("/business/change-picture",{idBusiness:e,picture:s}).catch(console.log)];case 1:return(n=t.sent())&&!0===n.status?[4,Q()]:[3,3];case 2:return t.sent(),[2,!0];case 3:return[2,!1]}}))}));return function(s,n){return e.apply(this,arguments)}}(),ne=function(){var e=(0,t.Z)((function(e,s,n){var t,i;return(0,a.__generator)(this,(function(r){switch(r.label){case 0:return N(!0),[4,$(e)];case 1:return r.sent()?(localStorage.removeItem("business.config"),(t=D.query)&&Object.keys(t).length>0&&M?n="string"===typeof M?M:M[0]:s&&!D.route.includes("/website/dashboard")?n||(n="/website/dashboard"):(i=D.pathname.split("/"),n=i.length>1&&i[1]?"/".concat(i[1]):"/website"),[4,D.replace((0,g.fX)(n))]):[3,3];case 2:r.sent(),r.label=3;case 3:return N(!1),[2]}}))}));return function(s,n,t){return e.apply(this,arguments)}}(),te=function(){O(null),sessionStorage.removeItem("idBusiness"),sessionStorage.removeItem("businessName")};function ie(e){return re.apply(this,arguments)}function re(){return re=(0,t.Z)((function(e){var n,t,i,r,u,o,l,c,d,v,g;return(0,a.__generator)(this,(function(a){switch(a.label){case 0:return n=e.businessName,t=e.businessType,i=e.customBusinessType,r=e.countryId,u=e.location,o=e.language,l=e.domainAsTemplate,q(!0),d=(null===(c=K.user)||void 0===c?void 0:c.name)?K.user.name.split(" "):[""],[4,x("/business/create",{firstName:d[0],lastName:d.length>1?d.splice(1,d.length).join(" "):void 0,name:n,idCountry:r,type:null!==t&&void 0!==t?t:null,customType:null!==i&&void 0!==i?i:null,locationInfo:u,aiSettings:{language:o,voiceAndTone:"professional"},domainAsTemplate:l}).catch(console.log)];case 1:return(v=a.sent())&&!0===v.status?(g=v.content,s(g),[4,Q()]):[3,3];case 2:return a.sent(),q(!1),[3,4];case 3:return q(!1),[2,v];case 4:return[2]}}))})),re.apply(this,arguments)}var ue=function(){var e=(0,t.Z)((function(e){var s;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return[4,z("/business/delete-business",{idBusiness:e})];case 1:return!0===(null===(s=n.sent())||void 0===s?void 0:s.status)?(te(),setTimeout((0,t.Z)((function(){return(0,a.__generator)(this,(function(e){switch(e.label){case 0:return[4,Q()];case 1:return e.sent(),[2]}}))})),500),[2,!0]):s.status?[2]:[2,!1]}}))}));return function(s){return e.apply(this,arguments)}}(),ae=function(){var e=(0,t.Z)((function(e){var s;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return C(!0),[4,x("/business/accept-invitation",{invitationId:e})];case 1:return(s=n.sent()).status||g.Z9.error(s.message),[4,Q()];case 2:return n.sent(),C(!1),[2]}}))}));return function(s){return e.apply(this,arguments)}}(),oe=function(){var e=(0,t.Z)((function(e){var s;return(0,a.__generator)(this,(function(n){switch(n.label){case 0:return C(!0),[4,x("/business/decline-invitation",{invitationId:e})];case 1:return!0!==(null===(s=n.sent())||void 0===s?void 0:s.status)?[3,3]:[4,Q()];case 2:n.sent(),n.label=3;case 3:return s.status?(C(!1),[2]):[2,!1]}}))}));return function(s){return e.apply(this,arguments)}}();return{data:e?m:B,set:ne,unset:te,current:J,isChangingBusiness:k,isLoadingBusinesses:n,setBusinesses:w,changePicture:se,createBusiness:ie,isCreatingBusiness:j,deleteBusiness:ue,reloadBusinesses:V,invitations:y,acceptInvitation:ae,declineInvitation:oe,session:K,isProcessingInvitation:T,saveSelectedBusinessOnSession:s}}},15564:function(e,s,n){n.d(s,{k:function(){return u},v:function(){return a}});var t=n(26042),i=n(33299);function r(e,s){var n;return(null===e||void 0===e?void 0:e.idBusiness)?{_id:e.idBusiness,name:e.businessName}:(null===s||void 0===s||null===(n=s.business)||void 0===n?void 0:n._id)?{_id:s.business._id,name:s.business.name}:{}}function u(e){var s,n,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=(null===u||void 0===u?void 0:u.idBusiness)||(null===e||void 0===e||null===(s=e.business)||void 0===s?void 0:s._id)||sessionStorage.getItem("idBusiness"),l=r(u,e),c=(0,t.Z)({token:null===e||void 0===e||null===(n=e.user)||void 0===n?void 0:n.token,idBusiness:o,selectedBusiness:JSON.stringify(l),redirect:!1},u),d=(0,i.signIn)("revalidate-token",c);return a&&d.catch((function(e){console.warn("Failed to revalidate token",e),router.push("/login")})),d}function a(e,s){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3?arguments[3]:void 0,r=t?{_id:t._id,name:t.name}:{};return(0,i.signIn)("login-user",{email:e,password:s,callbackUrl:n,redirect:!1,selectedBusiness:JSON.stringify(r)})}}}]);
"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9645],{19645:function(e,n,t){t.d(n,{Z:function(){return S}});var o=t(47568),i=t(26042),r=t(69396),s=t(97582),a=t(57632),u=t(73292),c=t(33299),l=t(3732),d=t(85518),v=t(10253),p=t(61437),f=t(74865),g=t.n(f),h=t(30120),m=t(67294),w=t(87066),y=t(11163).useRouter;g().configure({showSpinner:!1});var b=function(){var e,n=function(){r(!1)},t=function(e,n){if(e.response){if(401===e.status&&function(){var e=(null===a||void 0===a?void 0:a.query).redirect;(0,c.signOut)({callbackUrl:"/login?redirect=".concat(e||a.asPath),redirect:!1}).then((function(e){a.push(e.url),sessionStorage.clear();try{localStorage.clear()}catch(n){}}))}(),403===e.status&&!a.pathname.includes("/upgrade")&&!a.pathname.includes("/welcome"))return function(e,n){switch(e){case"subscription-required":a.pathname.includes("/upgrade")||a.pathname.includes("/success")||document.querySelector(".paywall-modal")||r(n||e);break;case"paywall":a.pathname.includes("/upgrade")||a.pathname.includes("/success")||a.pathname.includes("/invoices/list")||a.pathname.includes("/dashboard")||document.querySelector(".paywall-modal")||r(n||e);break;case"subscription-past-due":a.push("/my-business/manage")}}(e.response.message,e.response.content),void n({status:!1});n({status:!1,message:e.response.message,content:e.response.content,code:e.response.status})}else n({status:!1,message:e.message})},i=(0,v.Z)((0,p.Z)("header-loader",!1),2)[1],r=(0,v.Z)((0,p.Z)("api-paywall",!1),2)[1],a=y(),u="https://api.durable.co",d=(0,c.useSession)().data,f="Bearer ".concat(null===d||void 0===d||null===(e=d.user)||void 0===e?void 0:e.token);function g(e,n,t){return b.apply(this,arguments)}function b(){return b=(0,o.Z)((function(e,n,t){var o,i,r,a,u;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return i=null===n||void 0===n?void 0:n.idBusiness,(null===n||void 0===n?void 0:n.idBusiness)&&t&&delete n.idBusiness,r=h.ou.now().toMillis(),[4,(0,l.Hl)(e,n,r,null===d||void 0===d||null===(o=d.user)||void 0===o?void 0:o.token)];case 1:return a=s.sent(),u=null!==i&&void 0!==i?i:(0,l.h_)(),[2,{"Content-Type":"application/json",Accept:"*/*",Authorization:f,"X-Timestamp":r,"X-Signature":a,"id-business":u}]}}))})),b.apply(this,arguments)}function _(){return _=(0,o.Z)((function(e,n){var o,r,a,c=arguments;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return o=!(c.length>2&&void 0!==c[2])||c[2],r=!(c.length>3&&void 0!==c[3])||c[3],o&&i(!0),[4,g(e,n,r)];case 1:return a=s.sent(),[2,new Promise((function(r,s){var c="".concat(e,"-").concat(JSON.stringify(n),"-").concat(a["id-business"]),l="cache:".concat(btoa(unescape(encodeURIComponent(c)))),d=sessionStorage.getItem(l);try{d=d?JSON.parse(d):null}catch(f){d=null}if(d&&(null===d||void 0===d?void 0:d.content)&&(null===d||void 0===d?void 0:d.timestamp)&&h.ou.now().diff(h.ou.fromMillis(d.timestamp),"seconds").seconds<4)o&&i(!1),r(d.content);else{var v=new Worker("/workers/api/get.js",{type:"module"});v.onmessage=function(e){var n=e.data,s=n.data;n.success?(o&&i(!1),sessionStorage.setItem(l,JSON.stringify({content:s,timestamp:h.ou.now().toMillis()})),setTimeout((function(){sessionStorage.removeItem(l)}),4e3),r(s)):(o&&i(!1),t(s,r))};var p=w.Z.getUri({baseURL:u,url:e,params:n});v.postMessage({uri:p,headers:a})}}))]}}))})),_.apply(this,arguments)}function k(){return k=(0,o.Z)((function(e,n){var o,r,a=arguments;return(0,s.__generator)(this,(function(s){switch(s.label){case 0:return o=!(a.length>2&&void 0!==a[2])||a[2],i(!0),[4,g(e,n,o)];case 1:return r=s.sent(),[2,new Promise((function(o,s){var a=new Worker("/workers/api/post.js",{type:"module"});a.onmessage=function(e){var n=e.data,r=n.data;n.success?(i(!1),o(r)):(i(!1),t(r,o))};var c=w.Z.getUri({baseURL:u,url:e});a.postMessage({uri:c,headers:r,data:n})}))]}}))})),k.apply(this,arguments)}return(0,m.useEffect)((function(){return a.events.on("routeChangeComplete",n),function(){a.events.off("routeChangeComplete",n)}}),[a.events]),{get:function(e,n){return _.apply(this,arguments)},post:function(e,n){return k.apply(this,arguments)}}},_=t(83454),k=btoa("durable_utm_params");function S(){var e=function(){var e,n;return null!==(n=null!==(e=sessionStorage.getItem("idBusiness"))&&void 0!==e?e:(0,l.ej)("ph_uuid"))&&void 0!==n?n:function(){var e=(0,a.Z)(),n=new Date(Date.now()+15552e6);return(0,l.d8)("ph_uuid",e,{expires:n}),e}()},n=function(){var e=(0,l.ej)(k);if(e)try{return JSON.parse(atob(e))}catch(n){return null}return null},t=function(){var e,n;return(null===window||void 0===window||null===(e=window.navigator)||void 0===e?void 0:e.platform)?window.navigator.platform.toString():(null===(n=window.navigator)||void 0===n?void 0:n.oscpu)?window.navigator.oscpu:"bot"},v=function(){var e;return/bot|googlebot|crawler|spider|robot|crawling/i.test(null===window||void 0===window||null===(e=window.navigator)||void 0===e?void 0:e.userAgent)?"bot":d.tq?"mobile":"desktop"},p=b(),f=p.get,g=p.post,h=(0,u.Z)().sendUserEvent,m=(0,c.useSession)().data;function w(){return y.apply(this,arguments)}function y(){return y=(0,o.Z)((function(){var e,n,t;return(0,s.__generator)(this,(function(o){switch(o.label){case 0:return e=null,[4,f("/user/get-location",{})];case 1:return(n=o.sent())&&!0===(null===n||void 0===n?void 0:n.status)&&(e=null===n||void 0===n||null===(t=n.content)||void 0===t?void 0:t.countryCode,(0,l.$K)(e)&&e&&(0,l.d8)("amp-country",e)),[2,e]}}))})),y.apply(this,arguments)}function S(e,n,t,o){return Z.apply(this,arguments)}function Z(){return(Z=(0,o.Z)((function(e,n,t,o){var i;return(0,s.__generator)(this,(function(r){switch(r.label){case 0:return(i=(0,l.ej)("amp-country"))?[3,2]:[4,w()];case 1:i=r.sent(),r.label=2;case 2:return n.country=i,U(e,n,t,o,!1),[2]}}))}))).apply(this,arguments)}function U(o){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,c=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];try{var l,d;if(u>5&&(u=5),a||(a=e()),s=(0,r.Z)((0,i.Z)({},null!==s&&void 0!==s?s:{}),{utm_params:n(),sentBy:(null===m||void 0===m||null===(l=m.user)||void 0===l?void 0:l.clerkId)||(null===m||void 0===m||null===(d=m.user)||void 0===d?void 0:d.id),platform:t(),device:v()}),"development"!==_.env.NEXT_PUBLIC_ENV&&!(null===s||void 0===s?void 0:s.country)&&c)return void S(o,s,a,u).catch((function(e){return console.log(e)}));"production"!==_.env.NEXT_PUBLIC_ENV&&console.log("[Analytics] Track event",o,JSON.stringify(s)),g("/analytics/track",{name:o,uid:a,payload:s}).then((function(e){(null===e||void 0===e?void 0:e.status)||(u>0?(setTimeout((function(){U(o,s,a,u-1)}),1e3*Math.pow(2,5-u)),console.log("Event ".concat(o," track failed. Retrying in ").concat(Math.pow(2,5-u)," seconds..."))):console.log("Event ".concat(o," track failed. All attempts failed!"))),h(o,s)}))}catch(p){console.error(p)}}return{track:U,getUtmParams:n,getUserUUID:e}}},73292:function(e,n,t){var o=t(26042),i=t(83454);n.Z=function(){return{sendUserEvent:function e(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;setTimeout((function(){(null===window||void 0===window?void 0:window.dataLayer)?("production"!==i.env.NEXT_PUBLIC_ENV&&console.log("[GA4] Track event: ".concat(n),t),((null===window||void 0===window?void 0:window.dataLayer)||[]).push((0,o.Z)({event:n},t))):r>0?(setTimeout((function(){e(n,t,r-1)}),100*Math.pow(2,5-r)),console.error("Event ".concat(n," track failed. Retrying in ").concat(Math.pow(2,5-r)," seconds..."))):console.error("[GA4] All tracking attempts failed!")}),100)}}}}}]);
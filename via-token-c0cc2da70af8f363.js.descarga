(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5387],{55509:function(e,n,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/login/via-token",function(){return s(19063)}])},19063:function(e,n,s){"use strict";s.r(n),s.d(n,{__N_SSP:function(){return d}});var t=s(47568),i=s(26042),a=s(69396),r=s(97582),u=s(85893),o=s(67294),c=s(33299),l=(0,o.memo)((function(e){var n=e.token,s=e.idBusiness,l=e.id,d=e.businessName,f=(0,c.useSession)(),_=f.update,v=f.data,b=f.status,h=(0,o.useCallback)((function(e,n){window.top.postMessage({event:"session-updated",status:e,error:n},"*")}),[]),w=(0,o.useCallback)((0,t.Z)((function(){var e;return(0,r.__generator)(this,(function(s){switch(s.label){case 0:return[4,(0,c.signIn)("via-token",{token:n,redirect:!1})];case 1:if(!(null===(e=s.sent())||void 0===e?void 0:e.ok))throw new Error("Failed to sign-in via token: ".concat(e.statusText));return[2]}}))})),[n]),k=(0,o.useCallback)((0,t.Z)((function(){return(0,r.__generator)(this,(function(e){switch(e.label){case 0:if(!s||!d)throw new Error("Business data incomplete: idBusiness: ".concat(s,", businessName: ").concat(d));return sessionStorage.setItem("idBusiness",s),sessionStorage.setItem("businessName",d),[4,_((0,a.Z)((0,i.Z)({},v),{business:{_id:s,name:d}}))];case 1:return e.sent(),[2]}}))})),[s,d,v,_]),g=(0,o.useCallback)((0,t.Z)((function(){var e,n,t,i;return(0,r.__generator)(this,(function(a){switch(a.label){case 0:return t=(null===v||void 0===v||null===(e=v.user)||void 0===e?void 0:e.id)!==l,i=(null===v||void 0===v||null===(n=v.business)||void 0===n?void 0:n._id)!==s,t||i?(h("loading"),t?[4,w()]:[3,2]):(h("ready"),[2]);case 1:a.sent(),a.label=2;case 2:return i?[4,k()]:[3,4];case 3:a.sent(),a.label=4;case 4:return h("ready"),[2]}}))})),[w,k,h,l,s,v]);return(0,o.useEffect)((function(){"loading"!==b&&g().catch((function(e){h("error",e)}))}),[g,b,h]),"loading"===b?(0,u.jsx)("div",{children:"Loading..."}):null}));l.auth=!1;var d=!0;n.default=l}},function(e){e.O(0,[9774,2888,179],(function(){return n=55509,e(e.s=n);var n}));var n=e.O();_N_E=n}]);